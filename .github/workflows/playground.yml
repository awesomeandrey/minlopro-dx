name: Playground üêö
run-name: "Playground [${{ inputs.environment }}] / '${{ github.actor }}'"

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Target Environment"
        required: true
        type: choice
        default: "Minlopro DevHub"
        options:
          - "Minlopro Prod"
          - "Minlopro DevHub"

permissions:
  contents: write
  id-token: write

env:
  SF_CLI_VERSION: "2.77.6"

# Jobs
jobs:
  playground-run:
    timeout-minutes: 10
    environment: ${{ inputs.environment }}
    env:
      SF_AUTH_URL: ${{ secrets.SF_AUTH_URL }}
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - id: build-env
        uses: ./.github/actions/build-env
        with:
          sfdx_auth_url: ${{ env.SF_AUTH_URL }}
      - name: 'Get Authenticated Org Alias'
        run: |
          echo "Auth org alias = ${{ steps.build-env.outputs.target-org-alias }}"
      - name: 'GHA Playground - Step #1'
        run: |
          echo "„ÄΩÔ∏è Target Environment"
          echo "ENV=${{ inputs.environment }}"
          echo "„ÄΩÔ∏è Environment Details"
          printenv | column -t -s "=" | sort
          echo "„ÄΩÔ∏è Installing Salesforce CLI (v${{ env.SF_CLI_VERSION }})"
          npm install @salesforce/cli@${{ env.SF_CLI_VERSION }} --global
          sf --version
          echo "„ÄΩÔ∏è Setting custom env variable"
          MINLOPRO_STATUS="Haha I'm playing with GHAs! Cool üíØ!"
          echo "Value: ${MINLOPRO_STATUS}"
          echo "MINLOPRO_STATUS=${MINLOPRO_STATUS}" >> $GITHUB_ENV
          echo "„ÄΩÔ∏è Get Salesforce CLI installation path"
          which sf
          echo "„ÄΩÔ∏è Get Global NPM Directory"
          npm config get prefix
      - name: 'GHA Playground - Step #2'
        run: |
          echo "„ÄΩÔ∏è Getting custom env variable"
          echo "Env variable value: ${MINLOPRO_STATUS}"
          echo "„ÄΩÔ∏è Listing Salesforce CLI Plugins & Adding Them As Summary"
          echo "### Salesforce CLI Plugins" >> $GITHUB_STEP_SUMMARY
          echo '```json' >> $GITHUB_STEP_SUMMARY
          sf plugins --json | jq '[.[].name]' >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
      - name: 'GHA Playground - Step #3'
        run: |
          echo "„ÄΩÔ∏è Getting custom env variable (cross-step)"
          echo "Env variable value: ${MINLOPRO_STATUS}"
          echo "PWD as cli tool: $(pwd)"
          echo "PWD as GHA env variable: ${{ env.PWD }}"
          echo "PWD as regular env variable: $PWD"
